spec:
  inputs:

---

.linux:
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /\[skip linux\]/'
      when: never
  tags:
    - saas-linux-medium-amd64

.macos:
  rules:
    # Only run macOS jobs inside the GWpy namespace where
    # macOS runners are available
    - if: '$CI_PROJECT_ROOT_NAMESPACE != "gwpy"'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /\[skip macos\]/'
      when: never
  tags:
    - saas-macos-medium-m1
  image: macos-15-xcode-16
  retry:
    # retry all windows jobs up to 2 times on failure, they are flaky
    max: 2
    when: always

.windows:
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /\[skip windows\]/'
      when: never
  variables:
    # windows gitlab runners don't support symbolic links, so we can't
    # run the tests that rely upon them
    PYTEST_ADDOPTS: "-k 'not table\\\\rate and not table\\\\tiles'"
    # pytest-xdist doesn't auto-detect the number of CPUs sometimes
    PYTEST_XDIST_AUTO_NUM_WORKERS: "2"
  tags:
    - saas-windows-medium-amd64
  retry:
    # retry all windows jobs up to 2 times on failure, they are flaky
    max: 2
    when: always
